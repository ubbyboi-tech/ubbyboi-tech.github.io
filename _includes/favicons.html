<!-- Favicons -->
<link
  rel="apple-touch-icon"
  sizes="180x180"
  href="{{ '/assets/img/favicons/favicon-512x512.png' | relative_url }}"
/>
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="{{ '/assets/img/favicons/favicon-32x32.png' | relative_url }}"
/>
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="{{ '/assets/img/favicons/favicon-16x16.png' | relative_url }}"
/>
<link
  rel="shortcut icon"
  href="{{ '/assets/img/favicons/favicon.ico' | relative_url }}"
/>
<link rel="icon" href="{{ '/favicon.ico' | relative_url }}" />

<!-- GLightbox CSS and JS -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

<!-- GLightbox Fix - MUST prevent navigation -->
<script>
  (function () {
    let glightboxInstance = null;

    // CRITICAL: Global click handler that runs FIRST (capture phase, highest priority)
    document.addEventListener(
      "click",
      function (e) {
        const link = e.target.closest("a.glightbox");
        if (link) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();

          const href =
            link.getAttribute("href") || link.getAttribute("data-href");

          // Wait for GLightbox to load
          if (typeof GLightbox !== "undefined") {
            if (!glightboxInstance) {
              glightboxInstance = GLightbox({
                selector: ".glightbox",
                closeButton: true,
                closeOnOutsideClick: true,
                touchNavigation: true,
                keyboardNavigation: true,
              });
              window.glightboxInstance = glightboxInstance;
            }

            if (href && href !== "#" && href !== "javascript:void(0)") {
              glightboxInstance.open(href);
            }
          } else {
            // If GLightbox not loaded yet, wait and try again
            setTimeout(function () {
              if (typeof GLightbox !== "undefined" && !glightboxInstance) {
                glightboxInstance = GLightbox({
                  selector: ".glightbox",
                  closeButton: true,
                  closeOnOutsideClick: true,
                  touchNavigation: true,
                  keyboardNavigation: true,
                });
                window.glightboxInstance = glightboxInstance;
                if (href && href !== "#" && href !== "javascript:void(0)") {
                  glightboxInstance.open(href);
                }
              }
            }, 100);
          }

          return false;
        }
      },
      true
    ); // Capture phase - runs BEFORE other handlers

    // Also remove href attributes to prevent any navigation
    function removeHrefs() {
      document.querySelectorAll("a.glightbox").forEach(function (link) {
        const href = link.getAttribute("href");
        if (href && !link.hasAttribute("data-href")) {
          link.setAttribute("data-href", href);
          link.setAttribute("href", "javascript:void(0)");
        }
      });
    }

    // Run immediately
    removeHrefs();

    // Run when DOM ready
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", function () {
        removeHrefs();
        if (typeof GLightbox !== "undefined" && !glightboxInstance) {
          glightboxInstance = GLightbox({
            selector: ".glightbox",
            closeButton: true,
            closeOnOutsideClick: true,
            touchNavigation: true,
            keyboardNavigation: true,
          });
          window.glightboxInstance = glightboxInstance;
        }
      });
    } else {
      removeHrefs();
    }

    // Run after page loads
    window.addEventListener("load", function () {
      setTimeout(removeHrefs, 50);
      setTimeout(removeHrefs, 200);
      setTimeout(removeHrefs, 500);

      if (typeof GLightbox !== "undefined" && !glightboxInstance) {
        glightboxInstance = GLightbox({
          selector: ".glightbox",
          closeButton: true,
          closeOnOutsideClick: true,
          touchNavigation: true,
          keyboardNavigation: true,
        });
        window.glightboxInstance = glightboxInstance;
      }
    });

    // Watch for new links added dynamically
    const observer = new MutationObserver(function () {
      removeHrefs();
    });

    if (document.body) {
      observer.observe(document.body, {
        childList: true,
        subtree: true,
      });
    } else {
      document.addEventListener("DOMContentLoaded", function () {
        observer.observe(document.body, {
          childList: true,
          subtree: true,
        });
      });
    }
  })();
</script>
